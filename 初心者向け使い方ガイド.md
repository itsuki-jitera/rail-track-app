# 🚄 軌道復元システム 初心者向け使い方ガイド

このガイドでは、軌道復元システムの基本的な使い方を、初めて使う方にもわかりやすく説明します。

## 📖 目次

1. [システムの起動](#システムの起動)
2. [基本画面の説明](#基本画面の説明)
3. [機能別ガイド](#機能別ガイド)
   - [CSVファイルのアップロードと波形表示](#1-csvファイルのアップロードと波形表示)
   - [偏心矢計算](#2-偏心矢計算)
   - [検測特性の確認](#3-検測特性の確認)
   - [偏心矢の変換](#4-偏心矢の変換)
4. [よくある質問](#よくある質問)
5. [トラブルシューティング](#トラブルシューティング)

---

## システムの起動

### 1. バックエンドサーバーの起動

まず、コマンドプロンプト（またはターミナル）を開きます。

```bash
# プロジェクトのバックエンドフォルダへ移動
cd rail-track-app/backend

# サーバーを起動
npm start
```

次のようなメッセージが表示されたら成功です：
```
🚀 Rail Track API Server is running on port 5000
```

> **注意**: このウィンドウは閉じないでください。閉じるとサーバーが停止します。

### 2. フロントエンドアプリの起動

新しいコマンドプロンプトを開きます（バックエンドのウィンドウはそのまま）。

```bash
# プロジェクトのフロントエンドフォルダへ移動
cd rail-track-app/frontend

# アプリを起動
npm run dev
```

次のようなメッセージが表示されたら成功です：
```
  ➜  Local:   http://localhost:3000/
```

### 3. ブラウザでアクセス

ブラウザ（Chrome、Edge、Firefoxなど）を開いて、以下のURLにアクセスします：

```
http://localhost:3000
```

軌道復元システムのメイン画面が表示されれば、起動完了です！

---

## 基本画面の説明

### メイン画面

起動すると、次のような画面が表示されます：

```
┌─────────────────────────────────────────┐
│   🚄 軌道復元システム                    │
├─────────────────────────────────────────┤
│                                         │
│  [ファイルアップロード領域]              │
│   📁 ここにCSVファイルをドロップ        │
│       または クリックして選択            │
│                                         │
├─────────────────────────────────────────┤
│  ナビゲーションボタン:                   │
│  • メイン                               │
│  • 📏 偏心矢計算                        │
└─────────────────────────────────────────┘
```

### 主要な要素

- **ファイルアップロード領域**: CSVファイルをドラッグ&ドロップできる場所
- **ナビゲーションボタン**: 各機能ページへ移動するボタン
- **グラフ表示エリア**: データをアップロードすると波形が表示される
- **統計情報**: データの最小値、最大値、平均値などが表示される

---

## 機能別ガイド

### 1. CSVファイルのアップロードと波形表示

#### ステップ1: サンプルデータの準備

プロジェクトフォルダには `sample-data.csv` というサンプルファイルがあります。
まずはこれを使って操作を試してみましょう。

#### ステップ2: ファイルのアップロード

方法は2つあります：

**方法A: ドラッグ&ドロップ**
1. エクスプローラーで `sample-data.csv` を探す
2. ファイルを画面のアップロード領域にドラッグ
3. ドロップする

**方法B: ファイル選択ダイアログ**
1. アップロード領域をクリック
2. ファイル選択ダイアログが開く
3. `sample-data.csv` を選択して「開く」をクリック

#### ステップ3: 結果の確認

ファイルをアップロードすると、自動的に：

1. **波形グラフが表示されます**
   - 横軸: 距離（メートル）
   - 縦軸: 軌道狂い量（ミリメートル）

2. **統計情報が表示されます**
   ```
   データ点数: 41
   最小値: 2.2 mm
   最大値: 6.7 mm
   平均値: 4.15 mm
   標準偏差: 1.52 mm
   ```

3. **波形復元ボタンが有効になります**
   - 「波形復元」ボタンをクリックすると、簡易的なフィルタ処理が実行されます
   - 復元後の波形が元の波形と一緒に表示されます

---

### 2. 偏心矢計算

偏心矢は、軌道の曲がり具合を数値化する重要な指標です。

#### ステップ1: 偏心矢計算ページへ移動

1. メイン画面の「📏 偏心矢計算」ボタンをクリック
2. 偏心矢計算専用ページが開きます

#### ステップ2: タブ1「偏心矢計算」を使用

画面上部に5つのタブがあります。最初は「偏心矢計算」タブが選択されています。

#### ステップ3: 測定データの入力

**サンプルデータを使う場合:**

テキストエリアに以下のようなJSON形式でデータを入力します：

```json
[
  {"distance": 0, "value": 1.5},
  {"distance": 0.25, "value": 1.8},
  {"distance": 0.5, "value": 2.1},
  {"distance": 0.75, "value": 1.9},
  {"distance": 1.0, "value": 1.6}
]
```

> **ヒント**: 実際の測定データがある場合は、この形式に変換してください。

#### ステップ4: パラメータの設定

以下のパラメータを設定します：

- **弦長p (m)**: 前方弦長（例: 10）
- **弦長q (m)**: 後方弦長（例: 5）
- **サンプリング間隔 (m)**: 測定点の間隔（例: 0.25）

**一般的な設定例:**
- 10-5m偏心矢: p=10, q=5, サンプリング間隔=0.25
- 5-5m偏心矢: p=5, q=5, サンプリング間隔=0.25

#### ステップ5: 計算実行

1. 「計算実行」ボタンをクリック
2. 数秒待つと結果が表示されます

#### ステップ6: 結果の確認

**表示される情報:**

1. **統計カード**: 計算結果の概要
   - 最小値
   - 最大値
   - 平均値
   - 標準偏差
   - データ点数

2. **波形グラフ**:
   - 元の測定データ（灰色の線）
   - 計算された偏心矢（青色の線）

3. **データテーブル**:
   - 各地点の距離、測定値、偏心矢の一覧表

---

### 3. 検測特性の確認

検測特性は、偏心矢計算がどの波長成分をどれだけ検出できるかを示します。

#### ステップ1: 「検測特性」タブを選択

偏心矢計算ページの上部にある「検測特性」タブをクリックします。

#### ステップ2: パラメータの設定

以下を設定します：

**偏心矢パラメータ:**
- 弦長p (m): 10
- 弦長q (m): 5
- サンプリング間隔 (m): 0.25

**波長範囲:**
- 最小波長 (m): 1（初期値のまま）
- 最大波長 (m): 200（初期値のまま）
- 波長刻み (m): 1（初期値のまま）

#### ステップ3: 特性計算

「特性計算」ボタンをクリックします。

#### ステップ4: 結果の確認

**表示されるグラフ:**

1. **振幅特性グラフ（上部）**
   - 横軸: 波長（メートル）
   - 縦軸: 振幅（無次元）
   - どの波長がどれだけ検出されるかを示す

2. **位相特性グラフ（下部）**
   - 横軸: 波長（メートル）
   - 縦軸: 位相（度）
   - 検出時の位相ずれを示す

**データテーブル:**
- 各波長での詳細な数値
- A係数、B係数、振幅、位相が一覧表示

---

### 4. 偏心矢の変換

異なる弦長で計算された偏心矢を、別の弦長の偏心矢に変換できます。

#### ステップ1: 「偏心矢変換」タブを選択

#### ステップ2: 変換元データの入力

「変換元データ」のテキストエリアに、変換したい偏心矢データを入力します。

**例:**
```json
[
  {"distance": 0, "value": 0.5},
  {"distance": 0.25, "value": 0.8},
  {"distance": 0.5, "value": 1.1}
]
```

#### ステップ3: パラメータの設定

**変換元パラメータ:**
- 弦長p1 (m): 10（元のデータの弦長）
- 弦長q1 (m): 5

**変換先パラメータ:**
- 弦長p2 (m): 5（変換後の弦長）
- 弦長q2 (m): 5

**サンプリング間隔:**
- 0.25 m

#### ステップ4: 変換実行

「変換実行」ボタンをクリックします。

#### ステップ5: 結果の確認

**表示される情報:**

1. **変換係数カード**
   - α係数: 主変換係数
   - β係数: 微分項係数

2. **比較グラフ**
   - 変換元データ（点線）
   - 変換後データ（実線）
   - 差分（下部、赤線）

3. **統計情報**
   - 変換前後の統計値比較

---

## よくある質問

### Q1: どんなデータ形式に対応していますか？

**A:** 以下の形式に対応しています：
- CSV形式（距離, 値）
- RSQ形式（軌道検測データの標準フォーマット）
- キヤデータ形式（車両検測データ）

### Q2: サンプリング間隔とは何ですか？

**A:** 測定点と測定点の距離のことです。
- 例: 0.25m → 25cmごとに測定
- 例: 0.5m → 50cmごとに測定

高速検測車では通常0.25mです。

### Q3: 弦長p、qとは何ですか？

**A:** 偏心矢を計算する際の基準となる距離です。
- p: 測定点から前方への距離
- q: 測定点から後方への距離

一般的な組み合わせ：
- 10-5m偏心矢: p=10m, q=5m
- 5-5m偏心矢: p=5m, q=5m（対称）

### Q4: 振幅特性グラフの見方を教えてください

**A:**
- **縦軸の値が1に近い**: その波長をよく検出できる
- **縦軸の値が0に近い**: その波長を検出しにくい

例: 振幅が0.8の場合、その波長の80%を検出できます。

### Q5: エラーが出たらどうすればいいですか？

**A:** 以下を確認してください：
1. バックエンドサーバーが起動しているか
2. フロントエンドが起動しているか
3. データ形式が正しいか（JSON形式など）
4. パラメータが妥当な値か（p, qは正の数）

---

## トラブルシューティング

### 🚨 問題1: 「サーバーに接続できません」エラー

**症状:**
- ファイルをアップロードしても反応がない
- エラーメッセージが表示される

**解決方法:**
1. バックエンドサーバーが起動しているか確認
2. コマンドプロンプトで以下を実行：
   ```bash
   cd rail-track-app/backend
   npm start
   ```
3. ブラウザをリロード（F5キー）

---

### 🚨 問題2: グラフが表示されない

**症状:**
- データをアップロードしてもグラフが出ない

**解決方法:**
1. ブラウザの開発者ツールを開く（F12キー）
2. コンソールにエラーがないか確認
3. データ形式が正しいか確認
4. ページをリロード

---

### 🚨 問題3: 「ポート5000が使用中」エラー

**症状:**
- バックエンド起動時にエラー

**解決方法（Windows）:**
```bash
# 使用中のプロセスを探す
netstat -ano | findstr :5000

# プロセスを終了（PIDは上記コマンドで確認）
taskkill /PID <PID番号> /F
```

---

### 🚨 問題4: データが大きすぎてアップロードできない

**症状:**
- 大きなファイルでタイムアウト

**解決方法:**
1. データを分割する
2. サンプリング間隔を大きくして点数を減らす
3. バックエンドのタイムアウト設定を変更

---

## 📚 さらに詳しい情報

詳細な技術仕様やAPI仕様については、以下のドキュメントを参照してください：

- **README.md**: システム全体の詳細仕様
- **技術仕様書.md**: アルゴリズムの詳細
- **APIドキュメント**: REST APIの詳細仕様

---

## 💡 活用のヒント

### ヒント1: 複数のパラメータを比較

「一括特性比較」タブを使うと、複数の弦長設定を同時に比較できます。

**使い方:**
1. 「一括特性比較」タブを選択
2. 「設定を追加」ボタンで複数の設定を追加
3. 各設定にわかりやすい名前を付ける
4. 「一括計算」ボタンをクリック

### ヒント2: 結果のスクリーンショット

重要な結果は、スクリーンショットを撮って保存しましょう。

**Windows:**
- 画面全体: PrintScreenキー
- ウィンドウのみ: Alt + PrintScreen
- 範囲指定: Windows + Shift + S

### ヒント3: データの準備

CSVデータを準備する際のポイント：
- 1行目はヘッダー（「距離(m), 値(mm)」など）
- 2行目からデータ
- 数値はカンマ区切り
- 小数点は「.」を使用

---

## 🎓 用語集

- **偏心矢（へんしんし）**: 軌道の曲がり具合を表す指標
- **弦長（げんちょう）**: 測定の基準となる距離
- **検測特性（けんそくとくせい）**: 測定装置の特性
- **振幅特性（しんぷくとくせい）**: 波長ごとの検出感度
- **位相特性（いそうとくせい）**: 波長ごとの位相ずれ
- **サンプリング間隔**: 測定点の間隔
- **波長（はちょう）**: 波形の繰り返し周期の長さ

---

**このガイドで不明な点があれば、README.mdの「サポート」セクションを参照してください。**

**良い軌道解析を！** 🚄✨
