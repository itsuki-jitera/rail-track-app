# 軌道復元システム - 使い方ガイド

## このアプリの目的

このアプリは、鉄道の**レールの状態を分析・改善する**ためのツールです。

鉄道のレールは長年使用すると少しずつ歪んだり、凹凸ができてしまいます。この凹凸のことを「軌道狂い」と呼びます。軌道狂いが大きくなると、電車の乗り心地が悪くなったり、安全性に問題が出たりします。

このシステムでは、レールの測定データをグラフで見やすく表示し、さらに**データを滑らかに補正する**ことで、より正確な軌道の状態を把握できるようにします。

---

## できること

### 1. 軌道データの可視化
- CSVファイル形式の測定データを読み込み
- 距離ごとの軌道狂い量をグラフで表示
- データの統計情報(最小値、最大値、平均値など)を確認

### 2. データの復元処理
- ノイズ(測定の誤差や細かいブレ)を除去
- 移動平均フィルタで波形を滑らかに補正
- 元データと復元データを比較して確認

### 3. 高度な解析機能 (タブ形式)

#### 📍 ピーク検出
- 軌道狂いの極大値・極小値を自動検出
- 特に問題のある地点を一目で把握

#### 🚨 異常値検出
- 統計的手法で通常と異なる測定値を検出
- 感度調整可能(シグマ倍率1.0~5.0)
- 重症度別に色分け表示

#### 📊 スペクトル解析
- FFT(高速フーリエ変換)による周波数解析
- 周期的な軌道狂いのパターンを発見
- 支配的な周波数成分を表示

#### 🔧 カント・スラック補正
- 曲線部の傾斜(カント)による影響を補正
- レール間隔(スラック)の影響を補正
- 補正前後の比較グラフで効果を確認

#### 📈 MTT軌道評価
- BC値・CD値による軌道品質の総合評価
- 鉄道業界標準の評価指標に基づく判定

#### 💾 データエクスポート
- CSV形式でのデータ出力
- Excel形式での出力
- 解析結果の保存と共有

### 4. データの分析
- 軌道狂いの傾向を視覚的に把握
- 統計値で全体の状態を数値で確認
- どの区間に問題があるかを特定

---

## 使い方の手順

### ステップ1: データファイルの準備

軌道測定データをCSVファイルで用意します。

**ファイル形式:**
```
0.0,2.5
0.5,2.8
1.0,3.2
1.5,3.8
2.0,4.5
...
```

- **1列目**: 測定地点の距離(メートル単位)
- **2列目**: その地点の軌道狂い量(ミリメートル単位)

※ このアプリに含まれる `sample-data.csv` をサンプルとして使用できます

### ステップ2: データのアップロード

1. アプリを開くと「データアップロード」セクションが表示されます
2. **「ファイルを選択」ボタン**をクリック
3. 用意したCSVファイルを選択
4. ファイルが読み込まれると以下が自動的に表示されます:
   - ファイル名
   - データ点数(測定地点の数)
   - 軌道波形グラフ(青色の線)
   - 統計情報(最小・最大・平均・標準偏差)

### ステップ3: グラフでデータを確認

**軌道波形データ**セクションにグラフが表示されます。

- **横軸**: 距離(m) - レールのどの位置か
- **縦軸**: 軌道狂い量(mm) - レールの歪みの大きさ
- **青色の線**: アップロードした元データ

グラフを見ることで、どの区間でレールが大きく歪んでいるかが一目で分かります。

### ステップ4: 統計情報の確認

**統計情報**セクションで以下の値を確認できます:

- **最小値**: 最もレールの状態が良い地点の狂い量
- **最大値**: 最もレールの状態が悪い地点の狂い量
- **平均値**: 全体の平均的な狂い量
- **標準偏差**: データのばらつき(大きいほど区間によって差が大きい)

### ステップ5: 波形の復元(補正処理)

測定データには細かいノイズ(誤差)が含まれていることがあります。より正確な軌道の状態を知るために、データを滑らかに補正します。

1. **「波形を復元」ボタン**をクリック
2. システムが移動平均フィルタを適用して処理を実行
3. 処理が完了すると:
   - グラフに**赤色の線**(復元データ)が追加表示されます
   - 統計情報に「復元データ」の欄が追加されます

### ステップ6: 元データと復元データの比較

グラフには2本の線が表示されます:

- **青色の線**: 元の測定データ(細かい変動を含む)
- **赤色の線**: 復元データ(滑らかに補正されたデータ)

この2つを比較することで:
- 本当の軌道の傾向(大きな波形)が分かる
- 測定ノイズと実際の問題を区別できる
- より正確な保守計画を立てられる

### ステップ7: 高度な解析機能の利用

画面下部の「高度な解析」セクションで、「表示する」ボタンをクリックすると、6つのタブが表示されます。

#### 📍 ピーク検出タブ
1. 「ピーク検出を実行」ボタンをクリック
2. グラフ上に赤い点(極大値)と青い点(極小値)が表示されます
3. 問題箇所を一目で確認できます

#### 🚨 異常値検出タブ
1. シグマ倍率スライダーで感度を調整(標準は2.0)
   - 小さい値: より厳しく検出(多くの異常値)
   - 大きい値: より緩く検出(重要な異常値のみ)
2. 「異常値を検出」ボタンをクリック
3. 異常値が色分けされてテーブルに表示されます
   - 赤: 非常に大きな異常
   - オレンジ: 大きな異常
   - 黄色: 中程度の異常
   - 緑: 軽度の異常

#### 📊 スペクトル解析タブ
1. 「スペクトル解析を実行」ボタンをクリック
2. 周波数とパワーのグラフが表示されます
3. 支配的な周波数(繰り返しパターン)を確認できます
4. 例: 一定間隔で繰り返される軌道狂いを発見

#### 🔧 カント・スラック補正タブ
1. カント補正係数とスラック補正係数を入力
   - デフォルト: カント=1.0、スラック=1.0
2. 「補正を適用」ボタンをクリック
3. 補正前後の比較グラフが表示されます
4. 補正による改善効果を統計値で確認

#### 📈 MTT評価タブ
1. 「MTT計算を実行」ボタンをクリック
2. BC値とCD値が表示されます
   - BC値: 軌道狂いの基準値
   - CD値: 軌道変化量の基準値
3. 総合評価(優良/良好/要注意など)を確認

#### 💾 エクスポートタブ
1. 「CSV形式でエクスポート」または「Excel形式でエクスポート」をクリック
2. ファイルがダウンロードされます
3. 他のツールでデータを活用できます

---

## 画面の見方

### データアップロードセクション
ファイルを選択してデータを読み込むエリアです。

### 軌道波形データセクション
距離と軌道狂い量の関係をグラフで表示します。
- マウスでグラフにカーソルを合わせると、その地点の正確な値が表示されます

### 統計情報セクション
データの統計的な特徴を数値で確認できます。
- 元データと復元データの統計値を並べて比較できます

### 高度な解析セクション
6つのタブで専門的な解析機能にアクセスできます。
- タブをクリックすることで、各機能に切り替えられます
- 各タブには専用の実行ボタンと結果表示エリアがあります

---

## ご注意

- **対応ファイル形式**: CSVファイルのみ
- **データ形式**: 2列(距離, 軌道狂い量)のカンマ区切り
- **復元処理**: 簡易的な3点移動平均フィルタを使用
  - 各地点の値を、前後の値との平均で置き換えます
  - より高度なフィルタ処理が必要な場合は別途ご相談ください

---

## 活用例

### 保守計画の立案
- ピーク検出で軌道狂いが大きい区間を自動特定
- 異常値検出で優先的に補修すべき箇所を決定
- MTT評価で総合的な軌道品質を判断

### 軌道状態の詳細分析
- スペクトル解析で周期的な問題パターンを発見
- カント・スラック補正で曲線部の真の状態を把握
- エクスポート機能でデータを保存・共有

### 軌道状態の記録
- 定期的に測定してデータを保存
- 時系列で軌道の劣化傾向を把握
- CSV/Excel形式で履歴管理

### 補修効果の確認
- 補修前後のデータを比較
- 作業の効果を数値とグラフで確認
- MTT評価値の改善度合いを測定

### 専門的な解析
- FFTスペクトル解析で波長成分を分析
- 異常値の統計的検出で測定誤差と実際の問題を区別
- 複数の解析手法を組み合わせた総合的な評価

---

## よくある質問

**Q: ピーク検出と異常値検出の違いは?**
A: ピーク検出は波形の山と谷を見つけます。異常値検出は統計的に「通常と大きく異なる値」を見つけます。

**Q: シグマ倍率はどう設定すればいい?**
A: 標準は2.0です。厳しくチェックしたい場合は1.5~2.0、重要な異常のみ検出したい場合は2.5~3.0に設定します。

**Q: スペクトル解析の結果はどう読む?**
A: 高いパワー値を持つ周波数が、データに含まれる周期的なパターンです。例えば、一定間隔で繰り返される軌道狂いを発見できます。

**Q: MTT評価のBC値・CD値とは?**
A: BC値は軌道狂いの大きさ、CD値は軌道の変化率を表す鉄道業界の標準評価指標です。値が小さいほど良好な状態です。

---

## バージョン情報

- **バージョン**: 2.0.0
- **更新日**: 2025年10月
- **主な追加機能**: ピーク検出、異常値検出、スペクトル解析、カント・スラック補正、MTT評価、高度なFFTフィルター
