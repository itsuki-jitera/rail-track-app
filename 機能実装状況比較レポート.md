# 軌道復元システム - 機能実装状況比較レポート

## 📋 概要

文書「057_復元波形を用いた軌道整正計算の操作手順」で説明されている機能と、現在のアプリケーションの実装状況を比較調査した結果をまとめました。

## 🔍 調査結果サマリー

### 実装完了度: **約70%**

主要な計算エンジンと基本機能は実装されていますが、一部の高度な機能や細かい調整機能が未実装です。

## ✅ 実装済み機能

### 1. 復元波形計算 (RestorationEngine)
**実装状況**: ✅ 完全実装

- **逆フィルタ処理**: 6m-40m帯域通過フィルタ実装済み
- **波長範囲設定**: 下限6m、上限40m（可変）
- **統計情報計算**: σ値、良化率計算実装済み
- **ファイル場所**: `backend/src/algorithms/restoration-engine.js`

### 2. 計画線機能
**実装状況**: ✅ 基本機能実装済み

#### 実装済み:
- **計画線生成**: 移動平均による自動生成
- **計画線編集**: インタラクティブエディタで手動編集可能
- **凸型計画線**: こう上優先の計画線生成対応
- **UI画面**: `frontend/src/pages/PlanLinePage.tsx`
- **複数の編集コンポーネント**:
  - `FullscreenPlanLineEditor`
  - `InteractivePlanLineEditor`
  - `AdvancedPlanLineEditor`

#### 未実装:
- ❌ 計画線のゼロ点自動調整
- ❌ 移動量制限による計画線の自動修正

### 3. 移動量計算
**実装状況**: ✅ 実装済み

- **基本計算**: 移動量 = 計画線 - 復元波形
- **制限チェック**: 標準値30mm、最大値50mmの制限チェック
- **累積移動量**: 計算機能実装済み
- **作業区間分割**: 最大移動量による自動分割
- **ファイル**: `backend/src/algorithms/movement-calculator.js`

### 4. MTT/ALS データ出力
**実装状況**: ✅ 実装済み

- **ALS形式エクスポート**: `.WDT`ファイル生成
- **データフォーマット**: キロ程 + 横移動 + 縦移動
- **新幹線用分割出力**: 180データ単位での分割対応
- **MTT種別対応**: 補正機能実装
- **ファイル**: `backend/src/exporters/als-exporter.js`

### 5. 通り狂い処理
**実装状況**: ⚠️ 部分的実装

#### 実装済み:
- 左右レール別データ処理
- 曲線諸元の管理機能

#### 未実装:
- ❌ マヤ車補正率の適用機能
- ❌ 曲線諸元の台形差し引き処理

### 6. 高低狂い処理
**実装状況**: ✅ 基本機能実装済み

- **こう上優先**: 凸型計画線による上方向修正優先
- **波長範囲設定**: 高低と通りで別々に設定可能

## ❌ 未実装または不完全な機能

### 1. 手検測機能の詳細実装
**現状**: 基本的な入力画面はあるが、以下が未実装:
- チャート位置と現地位置の自動対応付け
- 相関係数による最適位置検出
- ±20m以内での波形比較

### 2. 復元波長範囲の詳細設定
**現状**: 固定値での実装
- 最高列車速度に基づく自動設定機能なし
- 新幹線用の3.5m-6m選択オプションなし
- 通り15m下限の試行オプションなし

### 3. 移動量制限の高度な処理
**現状**: 基本的な制限チェックのみ
- 制限超過時の計画線自動修正機能なし
- 不動点（駅、橋梁等）の詳細管理機能なし

### 4. MTT誘導機能
**現状**: データ出力のみ
- MTTフロント誘導のための補正計算が不完全
- MTT種別ごとの詳細な補正パラメータ管理なし

### 5. 保守困難箇所の特別処理
**現状**: 通常処理のみ
- 駅ホーム区間の特別処理なし
- 緩和曲線延伸箇所の管理機能なし

## 📊 機能実装状況一覧表

| 機能カテゴリ | 機能名 | 実装状況 | 備考 |
|------------|--------|---------|------|
| **復元波形計算** | 逆フィルタ処理 | ✅ 完全 | 6m-40m帯域通過 |
| | 波長範囲設定 | ⚠️ 部分的 | 固定値のみ |
| | 統計情報計算 | ✅ 完全 | σ値、良化率 |
| **計画線** | 自動生成 | ✅ 完全 | 移動平均方式 |
| | 手動編集 | ✅ 完全 | 複数エディタ実装 |
| | ゼロ点調整 | ❌ 未実装 | |
| | こう上優先 | ✅ 完全 | 凸型計画線 |
| **移動量** | 基本計算 | ✅ 完全 | |
| | 制限チェック | ✅ 完全 | 30mm/50mm |
| | 自動修正 | ❌ 未実装 | |
| **通り狂い** | 基本処理 | ✅ 完全 | |
| | 補正率適用 | ❌ 未実装 | |
| | 曲線諸元差引 | ❌ 未実装 | |
| **高低狂い** | 基本処理 | ✅ 完全 | |
| | こう上優先 | ✅ 完全 | |
| **手検測** | データ入力 | ✅ 完全 | |
| | 自動対応付け | ❌ 未実装 | |
| | 相関計算 | ❌ 未実装 | |
| **MTT/ALS** | データ出力 | ✅ 完全 | |
| | 誘導補正 | ⚠️ 部分的 | |
| | 新幹線分割 | ✅ 完全 | 180データ単位 |
| **特殊処理** | 不動点管理 | ⚠️ 部分的 | |
| | 保守困難箇所 | ❌ 未実装 | |

## 🎯 推奨される改善項目

### 優先度: 高
1. **計画線のゼロ点調整機能**
   - 復元波形のゼロ点を自動検出
   - 移動量制限に応じた計画線修正

2. **手検測の自動対応付け**
   - 相関係数計算の実装
   - 最適位置の自動検出

3. **復元波長範囲の動的設定**
   - 最高速度に基づく自動計算
   - 新幹線用オプションの追加

### 優先度: 中
4. **通り狂い補正率**
   - マヤ車データの補正機能
   - 曲線諸元の自動差引

5. **MTT誘導補正の詳細実装**
   - MTT種別ごとのパラメータ管理
   - フロント位置の最適化計算

### 優先度: 低
6. **保守困難箇所の特別処理**
   - 駅ホーム区間の識別
   - 特別な制限値の設定

## 📝 総評

現在のアプリケーションは、軌道整正計算の**基本的な機能は概ね実装**されています。特に：

### 強み:
- ✅ 復元波形計算エンジンが完全実装
- ✅ 計画線の編集機能が充実（複数のUIコンポーネント）
- ✅ 移動量計算とALSデータ出力が機能
- ✅ モダンなWeb UIで使いやすい

### 改善点:
- ⚠️ 自動化機能が不足（手動調整が必要な箇所が多い）
- ⚠️ 現場での細かい要求への対応が不完全
- ⚠️ 保守困難箇所への特別対応が未実装

### 結論:
基本的な軌道整正計算は実行可能ですが、実際の現場で求められる細かい調整や自動化機能については、追加開発が必要です。特に「計画線のゼロ点調整」と「手検測の自動対応付け」は、作業効率に大きく影響するため、優先的に実装することを推奨します。

---
**作成日**: 2024年12月
**調査実施**: レールテック株式会社 システム開発部